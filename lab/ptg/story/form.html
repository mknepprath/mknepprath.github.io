<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Story Tags Form</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//x2js.googlecode.com/hg/xml2json.js"></script>
<style>
body {
   background: #BFD7C1; /* light green */
   color: #262626;
   font-family: Arial, san-serif;
}
#contact-form {  
   background-color: #87C489; 
   width: 465px;  
   padding: 20px;  
   margin: 50px auto;  
   border-radius: 15px;    
   -moz-border-radius: 15px;  
   -webkit-border-radius: 15px;  
} 
  
#contact-form input,   
#contact-form select,   
#contact-form textarea,   
#contact-form label {  
   font-size: 15px;  
   margin-bottom: 2px;
   font-family: Arial, san-serif;
}  
  
#contact-form input,   
#contact-form select,   
#contact-form textarea {  
   width: 450px;
   background: #fff;
   border: 0; 
   -moz-border-radius: 5px;  
   -webkit-border-radius: 5px;  
   border-radius: 5px;
   margin-bottom: 25px;  
   padding: 5px;  
}  
  
#contact-form input:focus,   
#contact-form select:focus,   
#contact-form textarea:focus {  
   background-color: #E5E6E7; 
}  
  
#contact-form textarea {  
   height: 150px;   
}  

#contact-form #submit {  
   width: 450px;   
   color: #BFD7C1;  
   border: none;  
   background-color: #6EA070;
}  
  
#contact-form #submit:hover {  
   background-color: #BFD7C1;  
   color: #6EA070; 
}
input:required, textarea:required {  
   box-shadow: none;
   -moz-box-shadow: none;  
   -webkit-box-shadow: none;  
   -o-box-shadow: none;  
} 

#contact-form .required {  
   font-weight:bold;  
   color: #E5E6E7;      
}
#failure, #success {
   color: #6EA070; 
   display:none;  
}
#jsonArea {position: absolute; left: 10px; top: 10px;}
#xmlArea {position: absolute; left: 10px; top: 250px;}
</style>
</head>
<!-- http://stackoverflow.com/questions/11815985/how-to-call-soap-xml-webservice-in-javascript-or-jquery -->
<body>
<textarea id="jsonArea" cols="55" rows="15" placeholder="JSON"></textarea>
<textarea id="xmlArea" cols="55" rows="15" placeholder="XML"></textarea>
<div id="contact-form">  
   <h1></h1>
   <h2></h2>  
   <p id="failure"></p>  
   <p id="success"></p>  
   <form action="javascript:void(false);">  
      <label for="name" id="q1">Name: <span class="required">*</span></label>  
      <input type="text" id="name" name="Name" value="" placeholder="Your name" required="required" autofocus />  
       <span></span><br />   
      <label for="greeting" id="q2">Your greeting: <span class="required">*</span></label>  
      <input type="text" id="greeting" name="Greeting" value="" placeholder="Happy Holidays" required="required" />  
        <span></span><br />  
      <label for="website" id="q3">Date of event: </label>  
      <input type="date" id="date" name="fDate" value="" />  
         <span></span><br /> 
      <label for="message" id="q4">Narration: <span class="required">*</span></label>  
      <textarea id="message" name="Narration" placeholder="Write your message here, please." required></textarea>
      <span></span><br />  
<input id="other" name="Other" type="hidden" value="" />           
      <input type="submit" value="GO-BABY-GO!" id="submit" /> 
   </form>  
</div>
<script>
var qno = 1; // global question variable
var root = [{}]; // JSON array to keep answers - placeholder
$( document ).ready(function() {
// AUTO POPULATE SPANS WITH TYPED VALUES BEFORE SUBMIT
$("input").keyup(function(){
   var newAnswerVal = $(this).val();
   $(this).nextAll('span').first().text(newAnswerVal);
   if(newAnswerVal == ""){
       $(this).nextAll('span').first().text("");
   }
});
$("textarea").keyup(function(){
   var newAnswerVal = $(this).val();
   $(this).nextAll('span').first().text(newAnswerVal);
   if(newAnswerVal == ""){
       $(this).nextAll('span').first().text("");
   }
});
$("#date").change(function(){
   var newAnswerVal = $(this).val();
   $(this).nextAll('span').first().text(newAnswerVal);
   if(newAnswerVal == ""){
       $(this).nextAll('span').first().text("");
   }
});	
// END AUTO POPULATE SPANS WITH TYPED VALUES BEFORE SUBMIT	
// BEGIN LOAD QUESTIONS FROM XML	
$.ajax({
type: "GET",
url: "story.xml",
dataType: "xml",
success: function(xml) {
$(xml).find('question').each(function(){
var Titles = $(this).find('text').text();
var fldName = $(this).find('fldName').text()
//var Products = $("#productGrid").html();
$("#q"+qno).html(Titles);
$("#q"+qno).next('input').attr('name',fldName);
qno++;

});
},
//other code
error: function() {
alert("The XML File could not be processed correctly.");
}
});
// END LOAD QUESTIONS FROM XML	
	
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
				// need to add the other parameters required here. _type, _rank and __text
                o[this.name] = [o[this.name]];
				o[this.type] = [o[this.type]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};

$(function() {
    $('form').submit(function() {
        $('#jsonArea').text(JSON.stringify($('form').serializeObject()));
		var string = $('#jsonArea').val(); // GRAB string FROM jsonArea
		var root = JSON.parse(string); // assign string to JSON array

		var key = Object.keys(root); // set-up and grab keys
		// ASSIGN XML MANUALLY TO THE 5 VARIABLES (THIS CAN BE INCREASED)
var xml = '<?xml version="1.0"?><root><story><content>';
xml += '<storytag name="'+key[0]+'" type="text" rank="1">'+root.Name+'</storytag>';
xml += '<storytag name="'+key[1]+'" type="text" rank="2">'+root.Greeting+'</storytag>';
xml += '<storytag name="'+key[2]+'" type="text" rank="3">'+root.fDate+'</storytag>';
xml += '<storytag name="'+key[3]+'" type="text" rank="4">'+root.Narration+'</storytag>';
xml += '<storytag name="'+key[4]+'" type="text" rank="5">'+root.Other+'</storytag>';
xml += '</content></story></root>';

$('#xmlArea').val(xml); // PUT IT IN IT'S SPOT (EVENTUALLY A VARIABLE TO AJAX TO LJ)
});});});
</script>
</body>
</html>
